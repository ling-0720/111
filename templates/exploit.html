{% extends "base.html" %}

{% block content %}
<div class="container-fluid">
    <!-- 漏洞利用表单 -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">漏洞利用</h5>
                </div>
                <div class="card-body">
                    <form id="exploitForm">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label class="form-label">目标漏洞</label>
                                    <select class="form-select" id="vulnSelect">
                                        <option value="">选择漏洞...</option>
                                        <option value="CVE-2024-1234">CVE-2024-1234 - RCE漏洞</option>
                                        <option value="CVE-2024-5678">CVE-2024-5678 - 认证绕过</option>
                                        <option value="CVE-2024-9012">CVE-2024-9012 - SQL注入</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label class="form-label">利用方式</label>
                                    <select class="form-select" id="exploitMethod">
                                        <option value="auto">自动利用</option>
                                        <option value="manual">手动利用</option>
                                        <option value="custom">自定义利用</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label class="form-label">目标地址</label>
                                    <input type="text" class="form-control" id="targetAddress" placeholder="输入目标IP">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label class="form-label">&nbsp;</label>
                                    <button type="submit" class="btn btn-primary d-block w-100">
                                        <i class="fas fa-bug me-2"></i>开始利用
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- 利用结果列表 -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">利用结果</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>漏洞编号</th>
                                    <th>目标地址</th>
                                    <th>利用时间</th>
                                    <th>利用方式</th>
                                    <th>利用结果</th>
                                    <th>状态</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="exploitResultsTable">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// 模拟的利用结果数据
const mockExploitResults = [
    {
        id: 1,
        vulnId: "CVE-2024-1234",
        target: "192.168.1.100",
        exploitTime: "2024-03-27 10:30",
        method: "自动利用",
        result: "成功",
        status: "完成",
        details: "成功获取目标系统Shell权限"
    },
    {
        id: 2,
        vulnId: "CVE-2024-5678",
        target: "192.168.1.101",
        exploitTime: "2024-03-27 11:45",
        method: "手动利用",
        result: "失败",
        status: "完成",
        details: "目标系统已修复该漏洞"
    },
    {
        id: 3,
        vulnId: "CVE-2024-9012",
        target: "192.168.1.102",
        exploitTime: "2024-03-27 14:20",
        method: "自定义利用",
        result: "成功",
        status: "完成",
        details: "成功获取数据库管理员权限"
    }
];

// 页面加载时显示利用结果列表
document.addEventListener('DOMContentLoaded', function() {
    updateExploitResultsTable(mockExploitResults);
});

// 处理利用表单提交
document.getElementById('exploitForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const vulnId = document.getElementById('vulnSelect').value;
    const method = document.getElementById('exploitMethod').value;
    const target = document.getElementById('targetAddress').value;
    
    if (!vulnId || !target) {
        alert('请选择漏洞并输入目标地址');
        return;
    }
    
    // 创建新的利用结果
    const newResult = {
        id: mockExploitResults.length + 1,
        vulnId: vulnId,
        target: target,
        exploitTime: new Date().toLocaleString(),
        method: document.getElementById('exploitMethod').options[document.getElementById('exploitMethod').selectedIndex].text,
        result: "进行中",
        status: "进行中",
        details: "正在尝试利用漏洞..."
    };
    
    // 添加到列表并更新显示
    mockExploitResults.unshift(newResult);
    updateExploitResultsTable(mockExploitResults);
    
    // 模拟利用过程
    setTimeout(() => {
        newResult.status = "完成";
        newResult.result = Math.random() > 0.3 ? "成功" : "失败";
        newResult.details = newResult.result === "成功" ? 
            "成功利用漏洞，获取系统权限" : 
            "利用失败，目标系统可能已修复";
        updateExploitResultsTable(mockExploitResults);
    }, 3000);
});

function updateExploitResultsTable(results) {
    const tbody = document.getElementById('exploitResultsTable');
    tbody.innerHTML = '';
    
    results.forEach(result => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${result.id}</td>
            <td>${result.vulnId}</td>
            <td>${result.target}</td>
            <td>${result.exploitTime}</td>
            <td>${result.method}</td>
            <td>
                <span class="badge bg-${result.result === '成功' ? 'success' : 
                                      result.result === '失败' ? 'danger' : 'warning'}">
                    ${result.result}
                </span>
            </td>
            <td>
                <span class="badge bg-${result.status === '完成' ? 'success' : 'info'}">
                    ${result.status}
                </span>
            </td>
            <td>
                <div class="btn-group">
                    <button class="btn btn-sm btn-outline-primary" onclick="viewExploitDetails(${result.id})">
                        <i class="fas fa-info-circle"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-success" onclick="reExploit(${result.id})">
                        <i class="fas fa-redo"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteExploitResult(${result.id})">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

function viewExploitDetails(id) {
    const result = mockExploitResults.find(r => r.id === id);
    alert(`利用详情:\n${result.details}`);
}

function reExploit(id) {
    alert(`重新利用 ID: ${id}`);
}

function deleteExploitResult(id) {
    if (confirm(`确定要删除利用结果 ID: ${id} 吗？`)) {
        const index = mockExploitResults.findIndex(result => result.id === id);
        if (index !== -1) {
            mockExploitResults.splice(index, 1);
            updateExploitResultsTable(mockExploitResults);
        }
    }
}
</script>
{% endblock %} 